# .github/workflows/release.yml
name: CD â€“ Release des artefacts

# Se dÃ©clenche uniquement quand tu crÃ©es un tag de version
on:
    push:
        tags:
            - "v*.*.*" # Ex: v1.0.0, v1.2.3

jobs:
    release:
        name: ğŸ“¦ CrÃ©er la Release GitHub
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“¥ Checkout du code
              uses: actions/checkout@v4

            - name: â˜• Setup Java 21
              uses: actions/setup-java@v4
              with:
                  java-version: "21"
                  distribution: "temurin"
                  cache: "maven"

            - name: ğŸŸ¢ Setup Node.js 20
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
                  cache-dependency-path: webapp/package-lock.json

            - name: ğŸ“¦ Installation NPM
              run: npm ci
              working-directory: webapp

            - name: ğŸ—ï¸ Build Vue.js
              run: npm run build
              working-directory: webapp

            # Build complet sans les tests (dÃ©jÃ  validÃ©s par la CI)
            - name: ğŸ—ï¸ Build Maven complet (JAR + WAR)
              run: mvn clean package --no-transfer-progress -DskipTests

            # CrÃ©e automatiquement une GitHub Release avec les deux artefacts
            - name: ğŸš€ CrÃ©er la GitHub Release
              uses: softprops/action-gh-release@v2
              with:
                  # Les fichiers Ã  joindre Ã  la release
                  files: |
                      services/target/demande-conge-extension-services.jar
                      webapp/target/demande-conge-extension-webapp.war
                  # Corps du changelog automatique basÃ© sur les commits
                  generate_release_notes: true
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
